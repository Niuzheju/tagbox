var l=!0,r=!1;
(function(i,D,w){function x(h,e){function c(b){b=new E(b,e);b.b.insertBefore(m);b.b.css("maxWidth",a.g.width());a.a.push(b);x&&m.val("");p(l);q.hide();m.focus();f()}function k(b,e){b.remove();var d=a.a.indexOf(b);a.a.splice(d,1);b===n&&(n=w);f();p(l);e&&(-1===e?g(a.a[d-1]):1===e&&g(a.a[d]));o()}function f(){for(var d=[],c=0;c<a.a.length;c+=1)d.push(a.a[c].value);b.val(d.join(e.delimiter))}function g(a){n&&n.d();n!==a?(n=a,a.select()):n=w}function s(){n&&(n.d(),n=w)}function t(){var a=e.searchIn;"string"==
typeof a&&(a=[a]);if(i.isArray(a)){for(var b={},d=0;d<a.length;d+=1)b[a[d]]=10;return b}return a}function j(b){for(var d=0;d<a.a.length;d+=1)if(a.a[d].item===b)return l;return r}function o(){var b=e.items,c=[],h=m.val(),f=t();if(a.a.length===e.maxItems)q.hide(),m.removeAttr("placeholder");else if(m.attr("placeholder",B),""===h&&!e.autoShow)q.hide();else{if(""!==h){for(var g=0;g<b.length;g+=1){var k={item:b[g],i:F(b[g],h,f)};0<k.i&&(e.allowDuplicates||!j(k.item))&&c.push(k)}c=c.sort(function(a,b){return b.i-
a.i});for(g=0;g<c.length;g+=1)c[g]=c[g].item}else for(g=0;g<b.length;g+=1)(e.allowDuplicates||!j(b[g]))&&c.push(b[g]);q.q(c);q.p(h);q.l(d)}}function p(b){a.k==m.val()&&b!==l||(s(),a.k=m.val(),C.text(a.k),m.width(0),m.width(Math.min(a.g.width()-16,Math.max(a.g.width()-m.offset().left+a.g.offset().left+16,C.width(),1))),q.l(d))}var a=this;a.a=[];var b=a.input=i(h).hide();a.options=e;var d=a.g=i('<div class="tagbox-wrapper" />').click(function(a){var b=i(a.target).closest("input, .tagbox-token, .tagbox-wrapper");
b.is(".tagbox-token")?i(a.target).is("a")?k(b.data("token")):g(b.data("token")):s();m.focus()}).insertBefore(a.input),B=b.attr("placeholder"),m=i('<input type="text" />').attr({autocomplete:b.attr("autocomplete"),spellcheck:b.attr("spellcheck"),autocapitalize:b.attr("autocapitalize"),placeholder:B}).on("keyup keydown blur update change",p).on("keypress",function(a){if(13===a.keyCode&&m.val())return a.preventDefault(),r}).on("blur",function(){setTimeout(function(){a.e||q.hide();d.removeClass("focus")},
50)}).on("keydown",function(b){var d=m.val().length==m[0].selectionStart,h=0===m[0].selectionEnd,f=b.keyCode;if(37===f){if(n)return n===a.a[0]?s():g(a.a[a.a.indexOf(n)-1]),r;h&&a.a.length&&g(a.a[a.a.length-1])}if(39===f){if(n)return n===a.a[a.a.length-1]?s():g(a.a[a.a.indexOf(n)+1]),r;d&&a.a.length&&g(a.a[0])}if(n&&(46===f||8===f))return k(n,8===f?-1:1),r;if(8===f&&h&&a.a.length)return g(a.a[a.a.length-1]),r;if(q.visible){if(38===f)return q.o(),r;if(40===f)return q.n(),r;if(39==f&&d||13==f||9==f){if(d=
q.m())return c(d),r;if(e.allowNew)return c(e.createNew(m.val())),r}}else if(13==f)return r;if(a.a.length===e.maxItems&&9!=b.keyCode)return m.val(""),r;setTimeout(o,10)}).on("focus",function(){d.addClass("focus");o()}).appendTo(d),C=i("<span />").appendTo(d).css({position:"absolute",left:-1E5,width:"auto",display:"inline-block",whiteSpace:"nowrap",fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight"),fontVariant:b.css("fontVariant"),letterSpacing:b.css("letterSpacing")}),
q=a.r=new G(a,e);q.b.appendTo(e.dropdownContainer);if(b.val())for(var y=e.items,z=b.val().split(e.delimiter),A,u=0;u<z.length;u+=1){A=r;for(var v=0;v<y.length;v+=1)if(y[v][e.valueField]==z[u]){c(y[v]);A=l;break}!A&&e.allowNew&&c(e.createNew(z[u]))}var x=l;p(l);i(D).on("resize",function(){p(l)});a.j=c;var n}function E(h,e){var c=this,k=c.b=i('<div class="tagbox-token"><span></span><a>&times;</a></div>').data("token",c),f=e.tokenFormat;c.value="string"==typeof h?h:h[e.valueField];c.item=h;"string"==
typeof f?("string"==typeof h&&(h={value:h}),k.children("span").html(f.replace(/\{\{([^}]*)\}\}/g,function(c,e){return h[e]}))):k.children("span").html(f(h));c.remove=function(){k.data("token",null);k.remove();c.item=null;c.b=null};c.select=function(){k.addClass("selected")};c.d=function(){k.removeClass("selected")}}function G(h,e){function c(a,b){g&&g.d();o&&o.removeClass("selected");"number"!==typeof a&&(a=t.indexOf(a));0<=a?(g=t[a],g.select(),clearTimeout(p),b?p=setTimeout(function(){k(g.b)},80):
k(g.b)):(g=r,o&&o.addClass("selected"));s=a}function k(a){var b=a.offset().top-j.offset().top;0>b?j.scrollTop(b+j.scrollTop()):b>j.innerHeight()-a.outerHeight()&&j.scrollTop(b+j.scrollTop()-j.innerHeight()+a.outerHeight())}var f=this,g,s,t,j=f.b=i('<div class="tagbox-dropdown"><div class="list"></div></div>').css({maxHeight:e.maxHeight}).hide();if(e.allowNew)var o=i('<div class="tagbox-item new-item" />').prependTo(j).on("mousedown",function(){h.e=l}).on("mouseup",function(){h.e=r}).on("click",function(){h.j(e.createNew(f.h))});
f.l=function(a){j.offset();var b=a.offset(),d=j.parent().offset();j.parent().is("body")&&(d={top:0,left:0});j.css({top:b.top-d.top+a.height()+1,left:b.left-d.left,width:a.outerWidth()})};f.show=function(){j.show();f.visible=l};f.hide=function(){j.hide();f.visible=r};f.m=function(){if(g)return g.item};f.n=function(){s===t.length-1?e.allowNew&&f.h||0===t.length?c(-1):c(0):c(s+1)};f.o=function(){0===s?e.allowNew&&f.h?c(-1):c(t.length-1):(-1===s&&(s=t.length),c(s-1))};var p;f.p=function(a){o&&((f.h=a)?
o.show().text(e.newText.replace(/\{\{txt\}\}/g,a)):o.hide())};f.q=function(a){j.find(".list").empty();t=[];if(0<a.length){for(var b=0;b<Math.min(a.length,e.maxListItems);b+=1){var d=new H(a[b],e);d.b.appendTo(j.find(".list"));d.b.on("mouseover",function(a){return function(){c(a,l)}}(d));d.b.on("mousedown",function(){h.e=l}).on("mouseup",function(){h.e=r});d.b.on("click",function(a){return function(){h.j(a)}}(a[b]));t.push(d)}c(0)}else e.allowNew||i('<div class="tagbox-item empty"/>').text(e.emptyText).appendTo(j.find(".list")),
c(-1);f.show()}}function H(h,e){var c=this.b=i('<div class="tagbox-item" />');e.itemClass&&c.addClass(e.itemClass);this.item=h;var k=e.rowFormat;"string"==typeof k?("string"==typeof h&&(h={value:h}),c.html(k.replace(/\{\{([^}]*)\}\}/g,function(c,e){return h[e]}))):c.html(k(h));this.select=function(){c.addClass("selected")};this.d=function(){c.removeClass("selected")}}var F=function(){function h(a){return a.replace(/[\[\]\{\}\(\)\^\$\.\*\+\|]/g,function(a){return"\\"+a})}function e(a){return/[a-z]/.test(a)?
g:/[A-Z]/.test(a)?f:/[0-9]/.test(a)?i:/[\/\-_\.]/.test(a)?t:j}function c(a,b,d){a=e(a);return o[a][e(b)]+0.4*o[a][e(d)]}function k(a,b,d){if(0===b.length)return 100*d/a.length;if(0===a.length||!a.slice(d).match(RegExp(("^.*"+h(b.split("").join("~~K~~"))+".*$").split("~~K~~").join(".*"),"i")))return-1;for(var e=b.charAt(0),f=-1,g;d<a.length;d+=1)if(a.charAt(d).toLowerCase()===e.toLowerCase()){var j=k(a.substr(d),b.slice(1),1);if(-1!=j){var i=400/Math.max(1,d);0===a.substr(d).toLowerCase().indexOf(b.toLowerCase())&&
(i+=3*b.length*b.length);i+=c(a.charAt(d),0===d?"/":a.charAt(d-1),d===a.length-1?"/":a.charAt(d+1));i+=j;if(i>f){f=i;g=[d];j=j.f||[];for(i=0;i<j.length;i+=1)g.push(j[i]+d)}}}return{c:f,valueOf:function(){return this.c},f:g}}var f=0,g=1,i=2,t=3,j=4,o=[[0,240,120,240,220],[20,0,20,120,120],[140,140,0,140,140],[120,120,120,0,120],[120,120,120,160,0]],p=function(a,b){var d=RegExp("["+a+"]","g"),e={},c;lookup=function(a){return e[a]||a};for(c=0;c<a.length;c+=1)e[a.charAt(c)]=b.charAt(c);return function(a){return a.replace(d,
lookup)}}("\u00e0\u00e1\u00e2\u00e3\u00e4\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f9\u00fa\u00fb\u00fc\u00fd\u00ff\u00c0\u00c1\u00c2\u00c3\u00c4\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u00d9\u00da\u00db\u00dc\u00dd","aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY");return function(a,b,d){if("string"==typeof a)return k(p(a),p(b),0);var c={c:0,valueOf:function(){return this.c},f:{}},e;for(e in d)if(d.hasOwnProperty(e)&&
a.hasOwnProperty(e)){var f=k(p(a[e]),p(b),0);c.c+=d[e]*f;c.f[e]=0<f?f.f:[]}return c}}();i.fn.tagbox=function(h){var e=i.extend({},{maxHeight:200,maxListItems:20,rowFormat:"{{value}}",tokenFormat:"{{value}}",valueField:"value",delimiter:",",allowDuplicates:r,createNew:function(c){return{value:c}},allowNew:r,newText:"{{txt}}",emptyText:"Not Found",dropdownContainer:"body",maxItems:-1,autoShow:r},h);return this.each(function(){if(!i(this).data("tagbox")){var c=new x(this,e);i(this).data("tagbox",c)}})}})(jQuery,
window);
