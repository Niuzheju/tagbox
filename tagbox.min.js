var l=!0,s=!1;
(function(e,D,x){function y(j,c){function b(q){q=new E(q,c);q.b.insertBefore(m);a.a.push(q);y&&m.val("");i(l);r.hide();n()}function f(q,c){q.remove();var b=a.a.indexOf(q);a.a.splice(b,1);q===k&&(k=x);n();i(l);c&&(-1===c?h(a.a[b-1]):1===c&&h(a.a[b]));u()}function n(){for(var q=[],b=0;b<a.a.length;b+=1)q.push(a.a[b].value);o.val(q.join(c.delimiter))}function h(a){k&&k.d();k!==a?(k=a,a.select()):k=x}function p(){k&&(k.d(),k=x)}function g(){var a=c.searchIn;"string"==typeof a&&(a=[a]);if(e.isArray(a)){for(var b={},
f=0;f<a.length;f+=1)b[a[f]]=10;return b}return a}function t(b){for(var c=0;c<a.a.length;c+=1)if(a.a[c].item===b)return l;return s}function u(){var a=c.items,b=[],f=m.val(),o=g();if(""===f&&!c.autoShow)r.hide();else{if(""!==f){for(var d=0;d<a.length;d+=1){var i={item:a[d],f:F(a[d],f,o)};0<i.f&&(c.allowDuplicates||!t(i.item))&&b.push(i)}b=b.sort(function(a,b){return b.f-a.f});for(d=0;d<b.length;d+=1)b[d]=b[d].item}else for(d=0;d<a.length;d+=1)(c.allowDuplicates||!t(a[d]))&&b.push(a[d]);r.o(b);r.n(f)}}
function i(b){a.h==m.val()&&b!==l||(p(),a.h=m.val(),C.text(a.h),m.width(0),m.width(Math.min(a.g.width()-16,Math.max(a.g.width()-m.offset().left+a.g.offset().left-16,C.width(),1))),r.p(d))}var a=this;a.a=[];var o=a.input=e(j).hide();a.options=c;var d=a.g=e('<div class="tagbox-wrapper" />').click(function(a){var b=e(a.target).closest("input, .tagbox-token, .tagbox-wrapper");b.is(".tagbox-token")?e(a.target).is("a")?f(b.data("token")):h(b.data("token")):p();m.focus()}).insertBefore(a.input),m=e('<input type="text" />').on("keyup keydown blur update change",
i).on("blur",function(){setTimeout(function(){a.i||r.hide()},50)}).on("focus",u).on("keydown",function(d){var o=m.val().length==m[0].selectionStart,i=0===m[0].selectionEnd,d=d.keyCode;if(37===d){if(k)return k===a.a[0]?p():h(a.a[a.a.indexOf(k)-1]),s;i&&a.a.length&&h(a.a[a.a.length-1])}if(39===d){if(k)return k===a.a[a.a.length-1]?p():h(a.a[a.a.indexOf(k)+1]),s;o&&a.a.length&&h(a.a[0])}if(k&&(46===d||8===d))return f(k,8===d?-1:1),s;if(8===d&&i&&a.a.length)return h(a.a[a.a.length-1]),s;if(m.val()){if(38===
d)return r.m(),s;if(40===d)return r.l(),s;if(39==d&&o||13==d||9==d){if(o=r.k())return b(o),s;if(c.allowNew)return b(c.createNew(m.val())),s}}else if(13==d)return s;if(a.a.length===c.maxItems)return m.val(""),s;setTimeout(u,10)}).appendTo(d),C=e("<span />").appendTo(d).css({position:"absolute",left:-1E5,width:"auto",display:"inline-block",whiteSpace:"nowrap",fontSize:o.css("fontSize"),fontFamily:o.css("fontFamily"),fontWeight:o.css("fontWeight"),fontVariant:o.css("fontVariant"),letterSpacing:o.css("letterSpacing")}),
r=a.q=new G(a,c);r.b.appendTo(c.dropdownContainer);if(o.val())for(var z=c.items,A=o.val().split(c.delimiter),B,v=0;v<A.length;v+=1){B=s;for(var w=0;w<z.length;w+=1)if(z[w][c.valueField]==A[v]){b(z[w]);B=l;break}!B&&c.allowNew&&b(c.createNew(A[v]))}var y=l;i(l);e(D).on("resize",function(){i(l)});a.j=b;var k}function E(j,c){var b=this,f=b.b=e('<div class="tagbox-token"><span></span><a>&times;</a></div>').data("token",b),n=c.tokenFormat;"string"==typeof n?f.children("span").html(n.replace(/\{\{([^}]*)\}\}/g,
function(b,c){return j[c]})):f.children("span").html(n(j));b.value=j[c.valueField];b.item=j;b.remove=function(){f.data("token",null);f.remove();b.item=null;b.b=null};b.select=function(){f.addClass("selected")};b.d=function(){f.removeClass("selected")}}function G(j,c){function b(b){n&&n.d();t&&t.removeClass("selected");"number"!==typeof b&&(b=p.indexOf(b));if(0<=b){n=p[b];n.select();var c=n.b,a=c.offset().top-g.offset().top-g.scrollTop();0>a?g.scrollTop(c.offset().top-g.offset().top):a>g.height()-
c.height()&&g.scrollTop(a+g.scrollTop()-g.height()+c.height())}else n=s,t&&t.addClass("selected");h=b}var f=this,n,h,p,g=f.b=e('<div class="tagbox-dropdown"><div class="list"></div></div>').css({maxHeight:c.maxHeight}).hide();if(c.allowNew)var t=e('<div class="tagbox-item new-item" />').prependTo(g);f.p=function(b){g.offset();var c=b.offset(),a=g.parent().offset();g.parent().is("body")&&(a={top:0,left:0});g.css({top:c.top-a.top+b.height()+1,left:c.left-a.left,width:b.outerWidth()})};f.show=function(){g.show()};
f.hide=function(){g.hide()};f.k=function(){if(n)return n.item};f.l=function(){h===p.length-1?c.allowNew||0===p.length?b(-1):b(0):b(h+1)};f.m=function(){0===h?c.allowNew?b(-1):b(p.length-1):(-1===h&&(h=p.length),b(h-1))};f.n=function(b){g.find(".new-item").text(c.newText.replace(/\{\{txt\}\}/g,b))};f.o=function(h){g.find(".list").empty();p=[];if(0<h.length){for(var i=0;i<Math.min(h.length,c.maxListItems);i+=1){var a=new H(h[i],c);a.b.appendTo(g.find(".list"));a.b.on("mouseover",function(a){return function(){f.r(a)}}(a));
a.b.on("mousedown",function(){j.i=l}).on("mouseup",function(){j.i=s});a.b.on("click",function(a){return function(){j.j(a)}}(h[i]));p.push(a)}b(0)}else c.allowNew||e('<div class="tagbox-item empty"/>').text(c.emptyText).appendTo(g.find(".list")),b(-1);f.show()}}function H(j,c){var b=this.b=e('<div class="tagbox-item" />');c.itemClass&&b.addClass(c.itemClass);this.item=j;var f=c.rowFormat;"string"==typeof f?b.html(f.replace(/\{\{([^}]*)\}\}/g,function(b,c){return j[c]})):b.html(f(j));this.select=function(){b.addClass("selected")};
this.d=function(){b.removeClass("selected")}}var F=function(){function j(a){return a.replace(/[\[\]\{\}\(\)\^\$\.\*\+\|]/g,function(a){return"\\"+a})}function c(a){return/[a-z]/.test(a)?h:/[A-Z]/.test(a)?n:/[0-9]/.test(a)?e:/[\/\-_\.]/.test(a)?g:t}function b(a,b,d){a=c(a);return u[a][c(b)]+0.4*u[a][c(d)]}function f(a,c,d){if(0===c.length)return 100*d/a.length;if(0===a.length||!a.slice(d).match(RegExp(("^.*"+j(c.split("").join("~~K~~"))+".*$").split("~~K~~").join(".*"),"i")))return-1;for(var m=c.charAt(0),
i=-1,h;d<a.length;d+=1)if(a.charAt(d).toLowerCase()===m.toLowerCase()){var g=f(a.substr(d),c.slice(1),1);if(-1!=g){var e=400/Math.max(1,d);0===a.substr(d).toLowerCase().indexOf(c.toLowerCase())&&(e+=3*c.length*c.length);e+=b(a.charAt(d),0===d?"/":a.charAt(d-1),d===a.length-1?"/":a.charAt(d+1));e+=g;if(e>i){i=e;h=[d];g=g.e||[];for(e=0;e<g.length;e+=1)h.push(g[e]+d)}}}return{c:i,valueOf:function(){return this.c},e:h}}var n=0,h=1,e=2,g=3,t=4,u=[[0,240,120,240,220],[20,0,20,120,120],[140,140,0,140,140],
[120,120,120,0,120],[120,120,120,160,0]],i=function(a,b){var c=RegExp("["+a+"]","g"),f={},e;lookup=function(a){return f[a]||a};for(e=0;e<a.length;e+=1)f[a.charAt(e)]=b.charAt(e);return function(a){return a.replace(c,lookup)}}("\u00e0\u00e1\u00e2\u00e3\u00e4\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f9\u00fa\u00fb\u00fc\u00fd\u00ff\u00c0\u00c1\u00c2\u00c3\u00c4\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u00d9\u00da\u00db\u00dc\u00dd",
"aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY");return function(a,b,c){if("string"==typeof a)return f(i(a),i(b),0);var e={c:0,valueOf:function(){return this.c},e:{}},g;for(g in c)if(c.hasOwnProperty(g)&&a.hasOwnProperty(g)){var h=f(i(a[g]),i(b),0);e.c+=c[g]*h;e.e[g]=0<h?h.e:[]}return e}}();e.fn.tagbox=function(j){var c=e.extend({},{maxHeight:200,maxListItems:20,rowFormat:"{{name}}",tokenFormat:"{{name}}",valueField:"name",delimiter:",",allowDuplicates:s,createNew:function(b){return{name:b}},
allowNew:s,newText:"{{txt}}",emptyText:"Not Found",dropdownContainer:"body",maxItems:-1,autoShow:s},j);return this.each(function(){var b=new y(this,c);e(this).data("tagbox",b)})}})(jQuery,window);
