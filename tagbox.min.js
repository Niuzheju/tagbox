var m=!0,t=!1;
(function(j,D,x){function y(d,e){function f(r){r=new E(r,e);r.b.insertBefore(n);a.a.push(r);y&&n.val("");o(m);u.hide();g()}function k(r,b){r.remove();var e=a.a.indexOf(r);a.a.splice(e,1);r===l&&(l=x);g();o(m);b&&(-1===b?h(a.a[e-1]):1===b&&h(a.a[e]));s()}function g(){for(var r=[],c=0;c<a.a.length;c+=1)r.push(a.a[c].value);b.val(r.join(e.delimiter))}function h(a){l&&l.d();l!==a?(l=a,a.select()):l=x}function p(){l&&(l.d(),l=x)}function q(){var a=e.searchIn;"string"==typeof a&&(a=[a]);if(j.isArray(a)){for(var b={},
c=0;c<a.length;c+=1)b[a[c]]=10;return b}return a}function i(b){for(var c=0;c<a.a.length;c+=1)if(a.a[c].item===b)return m;return t}function s(){var a=e.items,b=[],c=n.val(),f=q();if(""===c&&!e.autoShow)u.hide();else{if(""!==c){for(var d=0;d<a.length;d+=1){var h={item:a[d],f:F(a[d],c,f)};0<h.f&&(e.allowDuplicates||!i(h.item))&&b.push(h)}b=b.sort(function(a,b){return b.f-a.f});for(d=0;d<b.length;d+=1)b[d]=b[d].item}else for(d=0;d<a.length;d+=1)(e.allowDuplicates||!i(a[d]))&&b.push(a[d]);u.o(b);u.n(c)}}
function o(b){a.h==n.val()&&b!==m||(p(),a.h=n.val(),C.text(a.h),n.width(0),n.width(Math.min(a.g.width()-16,Math.max(a.g.width()-n.offset().left+a.g.offset().left+16,C.width(),1))),u.p(c))}var a=this;a.a=[];var b=a.input=j(d).hide();a.options=e;var c=a.g=j('<div class="tagbox-wrapper" />').click(function(a){var b=j(a.target).closest("input, .tagbox-token, .tagbox-wrapper");b.is(".tagbox-token")?j(a.target).is("a")?k(b.data("token")):h(b.data("token")):p();n.focus()}).insertBefore(a.input),n=j('<input type="text" />').attr({autocomplete:b.attr("autocomplete"),
required:b.attr("required"),spellcheck:b.attr("spellcheck"),autocapitalize:b.attr("autocapitalize")}).on("keyup keydown blur update change",o).on("blur",function(){setTimeout(function(){a.i||u.hide()},50)}).on("focus",s).on("keydown",function(b){var c=n.val().length==n[0].selectionStart,d=0===n[0].selectionEnd,b=b.keyCode;if(37===b){if(l)return l===a.a[0]?p():h(a.a[a.a.indexOf(l)-1]),t;d&&a.a.length&&h(a.a[a.a.length-1])}if(39===b){if(l)return l===a.a[a.a.length-1]?p():h(a.a[a.a.indexOf(l)+1]),t;
c&&a.a.length&&h(a.a[0])}if(l&&(46===b||8===b))return k(l,8===b?-1:1),t;if(8===b&&d&&a.a.length)return h(a.a[a.a.length-1]),t;if(n.val()){if(38===b)return u.m(),t;if(40===b)return u.l(),t;if(39==b&&c||13==b||9==b){if(c=u.k())return f(c),t;if(e.allowNew)return f(e.createNew(n.val())),t}}else if(13==b)return t;if(a.a.length===e.maxItems)return n.val(""),t;setTimeout(s,10)}).appendTo(c),C=j("<span />").appendTo(c).css({position:"absolute",left:-1E5,width:"auto",display:"inline-block",whiteSpace:"nowrap",
fontSize:b.css("fontSize"),fontFamily:b.css("fontFamily"),fontWeight:b.css("fontWeight"),fontVariant:b.css("fontVariant"),letterSpacing:b.css("letterSpacing")}),u=a.q=new G(a,e);u.b.appendTo(e.dropdownContainer);if(b.val())for(var z=e.items,A=b.val().split(e.delimiter),B,v=0;v<A.length;v+=1){B=t;for(var w=0;w<z.length;w+=1)if(z[w][e.valueField]==A[v]){f(z[w]);B=m;break}!B&&e.allowNew&&f(e.createNew(A[v]))}var y=m;o(m);j(D).on("resize",function(){o(m)});a.j=f;var l}function E(d,e){var f=this,k=f.b=
j('<div class="tagbox-token"><span></span><a>&times;</a></div>').data("token",f),g=e.tokenFormat;f.value="string"==typeof d?d:d[e.valueField];f.item=d;"string"==typeof g?("string"==typeof d&&(d={value:d}),k.children("span").html(g.replace(/\{\{([^}]*)\}\}/g,function(e,f){return d[f]}))):k.children("span").html(g(d));f.remove=function(){k.data("token",null);k.remove();f.item=null;f.b=null};f.select=function(){k.addClass("selected")};f.d=function(){k.removeClass("selected")}}function G(d,e){function f(a,
b){h&&h.d();s&&s.removeClass("selected");"number"!==typeof a&&(a=q.indexOf(a));0<=a?(h=q[a],h.select(),clearTimeout(o),b?o=setTimeout(function(){k(h.b)},80):k(h.b)):(h=t,s&&s.addClass("selected"));p=a}function k(a){var b=a.offset().top-i.offset().top;0>b?i.scrollTop(b+i.scrollTop()):b>i.innerHeight()-a.outerHeight()&&i.scrollTop(b+i.scrollTop()-i.innerHeight()+a.outerHeight())}var g=this,h,p,q,i=g.b=j('<div class="tagbox-dropdown"><div class="list"></div></div>').css({maxHeight:e.maxHeight}).hide();
if(e.allowNew)var s=j('<div class="tagbox-item new-item" />').prependTo(i);g.p=function(a){i.offset();var b=a.offset(),c=i.parent().offset();i.parent().is("body")&&(c={top:0,left:0});i.css({top:b.top-c.top+a.height()+1,left:b.left-c.left,width:a.outerWidth()})};g.show=function(){i.show()};g.hide=function(){i.hide()};g.k=function(){if(h)return h.item};g.l=function(){p===q.length-1?e.allowNew||0===q.length?f(-1):f(0):f(p+1)};g.m=function(){0===p?e.allowNew?f(-1):f(q.length-1):(-1===p&&(p=q.length),
f(p-1))};var o;g.n=function(a){i.find(".new-item").text(e.newText.replace(/\{\{txt\}\}/g,a))};g.o=function(a){i.find(".list").empty();q=[];if(0<a.length){for(var b=0;b<Math.min(a.length,e.maxListItems);b+=1){var c=new H(a[b],e);c.b.appendTo(i.find(".list"));c.b.on("mouseover",function(a){return function(){f(a,m)}}(c));c.b.on("mousedown",function(){d.i=m}).on("mouseup",function(){d.i=t});c.b.on("click",function(a){return function(){d.j(a)}}(a[b]));q.push(c)}f(0)}else e.allowNew||j('<div class="tagbox-item empty"/>').text(e.emptyText).appendTo(i.find(".list")),
f(-1);g.show()}}function H(d,e){var f=this.b=j('<div class="tagbox-item" />');e.itemClass&&f.addClass(e.itemClass);this.item=d;var k=e.rowFormat;"string"==typeof k?("string"==typeof d&&(d={value:d}),f.html(k.replace(/\{\{([^}]*)\}\}/g,function(e,f){return d[f]}))):f.html(k(d));this.select=function(){f.addClass("selected")};this.d=function(){f.removeClass("selected")}}var F=function(){function d(a){return a.replace(/[\[\]\{\}\(\)\^\$\.\*\+\|]/g,function(a){return"\\"+a})}function e(a){return/[a-z]/.test(a)?
h:/[A-Z]/.test(a)?g:/[0-9]/.test(a)?j:/[\/\-_\.]/.test(a)?q:i}function f(a,b,c){a=e(a);return s[a][e(b)]+0.4*s[a][e(c)]}function k(a,b,c){if(0===b.length)return 100*c/a.length;if(0===a.length||!a.slice(c).match(RegExp(("^.*"+d(b.split("").join("~~K~~"))+".*$").split("~~K~~").join(".*"),"i")))return-1;for(var e=b.charAt(0),h=-1,i;c<a.length;c+=1)if(a.charAt(c).toLowerCase()===e.toLowerCase()){var j=k(a.substr(c),b.slice(1),1);if(-1!=j){var g=400/Math.max(1,c);0===a.substr(c).toLowerCase().indexOf(b.toLowerCase())&&
(g+=3*b.length*b.length);g+=f(a.charAt(c),0===c?"/":a.charAt(c-1),c===a.length-1?"/":a.charAt(c+1));g+=j;if(g>h){h=g;i=[c];j=j.e||[];for(g=0;g<j.length;g+=1)i.push(j[g]+c)}}}return{c:h,valueOf:function(){return this.c},e:i}}var g=0,h=1,j=2,q=3,i=4,s=[[0,240,120,240,220],[20,0,20,120,120],[140,140,0,140,140],[120,120,120,0,120],[120,120,120,160,0]],o=function(a,b){var c=RegExp("["+a+"]","g"),e={},d;lookup=function(a){return e[a]||a};for(d=0;d<a.length;d+=1)e[a.charAt(d)]=b.charAt(d);return function(a){return a.replace(c,
lookup)}}("\u00e0\u00e1\u00e2\u00e3\u00e4\u00e7\u00e8\u00e9\u00ea\u00eb\u00ec\u00ed\u00ee\u00ef\u00f1\u00f2\u00f3\u00f4\u00f5\u00f6\u00f9\u00fa\u00fb\u00fc\u00fd\u00ff\u00c0\u00c1\u00c2\u00c3\u00c4\u00c7\u00c8\u00c9\u00ca\u00cb\u00cc\u00cd\u00ce\u00cf\u00d1\u00d2\u00d3\u00d4\u00d5\u00d6\u00d9\u00da\u00db\u00dc\u00dd","aaaaaceeeeiiiinooooouuuuyyAAAAACEEEEIIIINOOOOOUUUUY");return function(a,b,c){if("string"==typeof a)return k(o(a),o(b),0);var d={c:0,valueOf:function(){return this.c},e:{}},e;for(e in c)if(c.hasOwnProperty(e)&&
a.hasOwnProperty(e)){var f=k(o(a[e]),o(b),0);d.c+=c[e]*f;d.e[e]=0<f?f.e:[]}return d}}();j.fn.tagbox=function(d){var e=j.extend({},{maxHeight:200,maxListItems:20,rowFormat:"{{name}}",tokenFormat:"{{name}}",valueField:"name",delimiter:",",allowDuplicates:t,createNew:function(d){return{name:d}},allowNew:t,newText:"{{txt}}",emptyText:"Not Found",dropdownContainer:"body",maxItems:-1,autoShow:t},d);return this.each(function(){if(!j(this).data("tagbox")){var d=new y(this,e);j(this).data("tagbox",d)}})}})(jQuery,
window);
